<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>vue自定义事件</title>
		<style>
			[v-cloak]: {display: none;}
		</style>
	</head>
	<body>
	<div id="app" v-cloak>
		<com-input :inputtype="'text'" v-model="defaultValue"></com-input>
		<span>value: {{ defaultValue }}</span>
		<br />
		<!--将原生事件绑定到组件 .native 修饰符-->
		<com-input :inputtype="'text'" @focus.native="onFocus"></com-input>
		
		<!--在组件绑定原生事件有时很有用，但只能绑定到根元素上，组件通常会有多层级DOM，
		如果要绑定原生事件到子元素上，Vue提供一个 $listeners 属性，里面包含了作用在这个组件上的所有监听器-->
		<com-inputs @change.native="changed" :label="'listeners'" :value="'default value'"></com-inputs>
		
	</div>
		
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script>
		//一个组件上的v-model默认会利用名为 value 的 prop 和名为 input 的事件,但可以使用model选项来更改
		Vue.component('com-input', {
			model: {
				prop: 'defaultValue',
				event: 'change'
			},
			props: {
				defaultValue: {type: String},
				inputtype: {
					type: String,
					default: 'text',
					required: true,
					validator: function(type){
						return ['text', 'radio', 'checkbox', 'button', 'textarea', 'password', 'hidden'].indexOf(type) !== -1;
					}
				}
			},
			template: '<input\
			  :type="inputtype"\
				:value="defaultValue"\
				@change="$emit(\'change\', $event.target.value)"\
			/>'
		});
		
		//$listeners属性的使用
		Vue.component('com-inputs', {
			inheritAttrs: false, //禁用根元素继承特性, 配合 $attrs 属性使用
			props: ['label', 'value'],
			computed: {
				inputListeners: function() {
					var vm = this;
					//Object.assign 将所有对象合并为一个新对象
					return Object.assign({}, 
					  this.$listeners, //从父级添加所有的监听器
						{
							input: function(event){ //确保组件配合 v-model 的工作
								vm.$emit('input', event.target.value);
							}
						}
					);
				}
			},
			//$attrs--继承所有的父组件属性（除了prop传递的属性、class 和 style ）
			template: '<div>\
			  <label>{{ label }} : \
				<input v-bind="$attrs" :value="value" v-on="inputListeners" />\
				</label>\
			</div>'
		});
		
		
		var app = new Vue({
			el: '#app',
			data: {
				defaultValue: ''
			},
			methods: {
				onFocus: function(){
					this.defaultValue = 'focus';
				},
				changed: function(){
					alert('changed');
				}
			}
		});
	</script>
	</body>
</html>
